<%- include('../layouts/header') %>

<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <h2>Add Transaction</h2>
    <div>
        <a href="/demo/portfolio/<%= portfolio._id %>" style="margin-right: 10px;">‚Üê Back to Portfolio</a>
        <a href="/demo/dashboard" style="margin-right: 10px;">Dashboard</a>
        <a href="/demo/logout">Logout</a>
    </div>
</div>

<div style="background-color: #e3f2fd; padding: 15px; border-radius: 4px; margin-bottom: 20px;">
    <strong>Portfolio:</strong> <%= portfolio.name %>
    <span style="color: #666;">(<%= portfolio.currency || 'USD' %>)</span>
</div>

<% if (error) { %>
    <div class="alert alert-error">
        <%= error %>
    </div>
<% } %>

<div class="card">
    <div style="border-bottom: 1px solid #e0e0e0; margin-bottom: 20px; padding-bottom: 15px;">
        <h3 style="margin: 0; color: #2c3e50;">üìä Transaction Details</h3>
        <p style="margin: 5px 0 0 0; color: #666;">Enter the details of your buy or sell transaction</p>
    </div>

    <form action="/demo/portfolio/<%= portfolio._id %>/transaction/add" method="POST" id="transactionForm">
        
        <!-- Transaction Type Selection -->
        <div style="margin-bottom: 30px;">
            <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #2c3e50;">Transaction Type *</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <label style="
                        display: flex; align-items: center; justify-content: center;
                        padding: 20px; border: 2px solid #e0e0e0; border-radius: 8px;
                        cursor: pointer; transition: all 0.2s ease;
                        background-color: white;
                    " id="buyOption">
                    <input type="radio" name="type" value="BUY" required style="margin-right: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">üõí</div>
                        <div style="font-weight: 600; color: #4CAF50;">BUY</div>
                        <div style="font-size: 0.9em; color: #666;">Purchase shares</div>
                    </div>
                </label>
                <label style="
                        display: flex; align-items: center; justify-content: center;
                        padding: 20px; border: 2px solid #e0e0e0; border-radius: 8px;
                        cursor: pointer; transition: all 0.2s ease;
                        background-color: white;
                    " id="sellOption">
                    <input type="radio" name="type" value="SELL" required style="margin-right: 10px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2em; margin-bottom: 5px;">üí∞</div>
                        <div style="font-weight: 600; color: #f44336;">SELL</div>
                        <div style="font-size: 0.9em; color: #666;">Sell shares</div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Stock Symbol Input -->
        <div style="margin-bottom: 25px;">
            <label for="symbol" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                Stock Symbol *
            </label>
            <div style="position: relative;">
                <input type="text" 
                       id="symbol" 
                       name="symbol" 
                       required 
                       placeholder="e.g., AAPL, GOOGL, TSLA"
                       style="
                            width: 100%; 
                            padding: 15px 20px 15px 50px; 
                            border: 2px solid #e0e0e0; 
                            border-radius: 8px; 
                            font-size: 16px; 
                            font-weight: 600;
                            text-transform: uppercase; 
                            transition: border-color 0.2s ease;
                            background-color: #f8f9fa;
                        " 
                       maxlength="10">
                <div style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 1.2em;">üìà</div>
            </div>
            <small style="color: #666; display: block; margin-top: 8px;">
                Enter the stock ticker symbol (automatically converted to uppercase)
            </small>
        </div>

        <!-- Quantity and Price Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px;">
            
            <!-- Quantity Input -->
            <div>
                <label for="qty" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                    Quantity *
                </label>
                <div style="position: relative;">
                    <input type="number" 
                           id="qty" 
                           name="qty" 
                           required 
                           min="0.001" 
                           step="0.001" 
                           placeholder="100"
                           style="
                                width: 100%; 
                                padding: 15px 20px 15px 45px; 
                                border: 2px solid #e0e0e0; 
                                border-radius: 8px; 
                                font-size: 16px;
                                transition: border-color 0.2s ease;
                                background-color: #f8f9fa;
                            ">
                    <div style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #666;">üìä</div>
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Number of shares (decimals allowed)
                </small>
            </div>

            <!-- Price Input -->
            <div>
                <label for="price" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2c3e50;">
                    Price per Share *
                </label>
                <div style="position: relative;">
                    <input type="number" 
                           id="price" 
                           name="price" 
                           required 
                           min="0.01" 
                           step="0.01" 
                           placeholder="150.00"
                           style="
                                width: 100%; 
                                padding: 15px 20px 15px 45px; 
                                border: 2px solid #e0e0e0; 
                                border-radius: 8px; 
                                font-size: 16px;
                                transition: border-color 0.2s ease;
                                background-color: #f8f9fa;
                            ">
                    <div style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #666;">$</div>
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    Price at which you bought/sold
                </small>
            </div>
        </div>

        <!-- Transaction Summary -->
        <div id="transaction-summary" 
             style="
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                padding: 20px; 
                border-radius: 8px; 
                margin-bottom: 25px; 
                display: none;
                border: 2px solid #e0e0e0;
             ">
            <h4 style="margin-top: 0; color: #2c3e50; display: flex; align-items: center;">
                <span style="margin-right: 10px;">üìã</span>
                Transaction Summary
            </h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div style="text-align: center; background-color: white; padding: 15px; border-radius: 6px;">
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Symbol</div>
                    <div style="font-weight: 600; font-size: 1.1em; color: #2c3e50;" id="summary-symbol">-</div>
                </div>
                <div style="text-align: center; background-color: white; padding: 15px; border-radius: 6px;">
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Type</div>
                    <div style="font-weight: 600; font-size: 1.1em;" id="summary-type">-</div>
                </div>
                <div style="text-align: center; background-color: white; padding: 15px; border-radius: 6px;">
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Quantity</div>
                    <div style="font-weight: 600; font-size: 1.1em; color: #2c3e50;" id="summary-qty">-</div>
                </div>
                <div style="text-align: center; background-color: white; padding: 15px; border-radius: 6px;">
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 5px;">Price</div>
                    <div style="font-weight: 600; font-size: 1.1em; color: #2c3e50;">$<span id="summary-price">-</span></div>
                </div>
            </div>
            <div style="text-align: center; background-color: white; padding: 20px; border-radius: 6px; border: 2px solid #4CAF50;">
                <div style="font-size: 1em; color: #666; margin-bottom: 5px;">Total Transaction Value</div>
                <div style="font-weight: bold; font-size: 1.8em; color: #4CAF50;">$<span id="summary-total">0.00</span></div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="submit" 
                    id="submitBtn"
                    style="
                        flex: 1; 
                        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); 
                        color: white; 
                        padding: 15px 20px; 
                        border: none; 
                        border-radius: 8px; 
                        font-size: 16px; 
                        font-weight: 600; 
                        cursor: pointer;
                        transition: all 0.2s ease;
                        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3);
                    ">
                <span style="margin-right: 8px;">üíæ</span>
                Add Transaction
            </button>
            <a href="/demo/portfolio/<%= portfolio._id %>"
               style="
                    flex: 0 0 auto; 
                    background-color: #6c757d; 
                    color: white; 
                    padding: 15px 20px; 
                    text-decoration: none; 
                    border-radius: 8px; 
                    font-size: 16px; 
                    font-weight: 600;
                    transition: all 0.2s ease;
                    text-align: center;
                    display: flex;
                    align-items: center;
                ">
                Cancel
            </a>
        </div>
    </form>
</div>

<style>
#buyOption:hover, #sellOption:hover {
    border-color: #2196F3;
    background: linear-gradient(135deg, #e3f2fd 0%, #ffffff 100%);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.2);
}

#buyOption input:checked ~ div,
#sellOption input:checked ~ div {
    transform: scale(1.05);
}

#submitBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(76, 175, 80, 0.4);
}

#symbol:focus, #qty:focus, #price:focus {
    border-color: #2196F3;
    box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
    background: white;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('transactionForm');
    const symbolInput = document.getElementById('symbol');
    const qtyInput = document.getElementById('qty');
    const priceInput = document.getElementById('price');
    const typeInputs = document.querySelectorAll('input[name="type"]');
    const summary = document.getElementById('transaction-summary');
    
    // Auto-uppercase symbol
    symbolInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase();
        updateSummary();
    });
    
    // Update summary on any input change
    qtyInput.addEventListener('input', updateSummary);
    priceInput.addEventListener('input', updateSummary);
    typeInputs.forEach(input => {
        input.addEventListener('change', updateSummary);
    });
    
    function updateSummary() {
        const symbol = symbolInput.value;
        const qty = parseFloat(qtyInput.value) || 0;
        const price = parseFloat(priceInput.value) || 0;
        const type = document.querySelector('input[name="type"]:checked');
        
        if (symbol && qty > 0 && price > 0 && type) {
            summary.style.display = 'block';
            
            document.getElementById('summary-symbol').textContent = symbol;
            document.getElementById('summary-type').textContent = type.value;
            document.getElementById('summary-type').style.color = type.value === 'BUY' ? '#4CAF50' : '#f44336';
            document.getElementById('summary-qty').textContent = qty.toLocaleString();
            document.getElementById('summary-price').textContent = price.toFixed(2);
            
            const total = qty * price;
            document.getElementById('summary-total').textContent = total.toFixed(2);
        } else {
            summary.style.display = 'none';
        }
    }
    
    // Form validation
    form.addEventListener('submit', function(e) {
        const symbol = symbolInput.value.trim();
        const qty = parseFloat(qtyInput.value);
        const price = parseFloat(priceInput.value);
        const type = document.querySelector('input[name="type"]:checked');
        
        if (!symbol || symbol.length < 1) {
            e.preventDefault();
            alert('Please enter a valid stock symbol');
            symbolInput.focus();
            return false;
        }
        
        if (!qty || qty <= 0) {
            e.preventDefault();
            alert('Please enter a valid quantity');
            qtyInput.focus();
            return false;
        }
        
        if (!price || price <= 0) {
            e.preventDefault();
            alert('Please enter a valid price');
            priceInput.focus();
            return false;
        }
        
        if (!type) {
            e.preventDefault();
            alert('Please select transaction type (BUY or SELL)');
            return false;
        }
        
        // Show loading state
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span style="margin-right: 8px;">‚è≥</span>Processing...';
        submitBtn.style.opacity = '0.7';
    });
    
    // Highlight selected option
    typeInputs.forEach(input => {
        input.addEventListener('change', function() {
            document.getElementById('buyOption').style.borderColor = '#e0e0e0';
            document.getElementById('sellOption').style.borderColor = '#e0e0e0';
            
            if (this.value === 'BUY') {
                document.getElementById('buyOption').style.borderColor = '#4CAF50';
                document.getElementById('buyOption').style.background = 'linear-gradient(135deg, #e8f5e9 0%, #ffffff 100%)';
                document.getElementById('sellOption').style.background = 'white';
            } else {
                document.getElementById('sellOption').style.borderColor = '#f44336';
                document.getElementById('sellOption').style.background = 'linear-gradient(135deg, #ffebee 0%, #ffffff 100%)';
                document.getElementById('buyOption').style.background = 'white';
            }
        });
    });
});
</script>

<%- include('../layouts/footer') %>